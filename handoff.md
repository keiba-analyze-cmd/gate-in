# ゲートイン！ 引き継ぎドキュメント

## 📅 最終更新: 2026-02-18

---

## 🏇 プロジェクト概要

**ゲートイン！** は競馬予想SNS＋学習プラットフォーム。ユーザーが競馬レースの予想を投稿し、的中率を競い合うソーシャルサービス。加えて、初心者向け学習記事やクイズも提供。

**本番URL**: Vercel にデプロイ済み
**リポジトリ**: `gate-in` (GitHub)

---

## 🏗️ アーキテクチャ

```
gate-in/
├── src/
│   ├── app/(main)/
│   │   ├── dojo/               # 道場（50コース対応 v3）
│   │   │   ├── articles/       # 記事一覧・詳細（認証不要）
│   │   │   ├── stage/[courseId]/[stageId]/ # クイズステージ
│   │   │   ├── stage/[courseId]/boss/      # BOSSステージ
│   │   │   ├── daily/          # デイリーチャレンジ
│   │   │   └── ranking/        # 道場ランキング
│   │   ├── contest/            # 大会
│   │   ├── races/, rankings/, timeline/, users/, settings/, admin/
│   │   └── page.tsx            # HOME（未ログイン→LP, ログイン→ダッシュボード）
│   ├── components/landing/LandingPage.tsx  # LP（道場プレビュー付き）
│   ├── lib/
│   │   ├── constants/dojo.ts   # 15クラスター×50コース×10ステージ+BOSS
│   │   ├── microcms.ts         # courseId/stageIdフィルタ対応
│   │   └── ...
├── quiz-gen/                   # クイズ生成（30コース/143ステージ/1,430問）
├── gate-in-article-gen/        # 記事生成（505本）
└── supabase/migrations/
```

---

## 🥋 道場システム（v3）

- **15クラスター × 50コース × 10ステージ + BOSS**
- 記事: 505本 / クイズ: 1,430問（microCMS）
- 対応: 30/50コース（残20はW8-16記事生成後）
- DojoClient: クラスター→コース→ステージの3階層UI
- 称号: 7段階（入門者〜師範代、コースクリア数基準）

---

## 🏆 週間予想大会（実装予定）

| 項目 | 内容 |
|---|---|
| 対象レース | WIN5対象レース（毎週日曜5レース） |
| ポイント | 現行システム＋連続的中ストリーク＋危険馬 |
| 景品 | 1位¥5,000 / 2位¥3,000 / 3位¥2,000（Amazonギフト） |
| タイブレーク | ①的中レース数 → ②投票の早さ |
| 法的根拠 | オープン懸賞→景品上限規制なし |

---

## ⚠️ 既知のバグ・注意点

1. **記事一覧「クイズ付き」表示バグ** — hasQuiz判定が全記事trueの可能性
2. **avatar_url はレガシー** — avatar_emoji を使用
3. **記事生成後処理** — `**bold**` → `<strong>` 変換必要

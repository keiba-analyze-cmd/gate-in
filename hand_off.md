# ğŸ‡ ã‚²ãƒ¼ãƒˆã‚¤ãƒ³ï¼ å¼•ãç¶™ããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

> **æœ€çµ‚æ›´æ–°: 2026-02-15**

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**ã‚²ãƒ¼ãƒˆã‚¤ãƒ³ï¼**ã¯ç«¶é¦¬äºˆæƒ³SNSã‚¢ãƒ—ãƒªã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒâ—â—‹â–³ã®3é ­ã‚’é¸ã‚“ã§æŠ•ç¥¨ã—ã€çµæœã«å¿œã˜ã¦ãƒã‚¤ãƒ³ãƒˆã‚’ç²å¾—ã€ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹ä»•çµ„ã¿ã€‚

- **URL**: https://gate-in.jp
- **GitHub**: https://github.com/keiba-analyze-cmd/gate-in
- **Tech**: Next.js 15 (App Router) + Supabase + Vercel + TypeScript + Tailwind CSS

---

## ç¾åœ¨ã®çŠ¶æ…‹

- **é€²æ—**: 73/90ã‚¿ã‚¹ã‚¯å®Œäº†ï¼ˆPhase Aã€œLå®Œäº†ï¼‰
- **æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚º**: Phase Gï¼ˆå°†æ¥æ©Ÿèƒ½ - ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã€ãƒ¬ãƒ¼ã‚¹å›é¡§ç­‰ï¼‰
- **ãƒ“ãƒ«ãƒ‰**: âœ… å…¨ã¦ãƒ‘ã‚¹

---

## ç›´è¿‘ã§å®Ÿæ–½ã—ãŸä½œæ¥­ï¼ˆPhase L: 2026-02-15ï¼‰

### 1. ãƒ¬ãƒ¼ã‚¹ä¸€è¦§ãƒšãƒ¼ã‚¸3ã‚»ã‚¯ã‚·ãƒ§ãƒ³åŒ–
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/(main)/races/page.tsx`
- å—ä»˜ä¸­ğŸŸ¢ï¼ˆdeadlineå‰ï¼‰/ æŠ•ç¥¨ç· åˆ‡ğŸŸ ï¼ˆdeadlineå¾Œãƒ»æœªç¢ºå®šï¼‰/ çµæœç¢ºå®šâ¬œï¼ˆfinishedï¼‰
- deadline = `post_time - 2åˆ†`

### 2. æŠ•ç¥¨çµæœã‚«ãƒ¼ãƒ‰è‰²åˆ†ã‘
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/races/RaceCard.tsx`
- çš„ä¸­: ç·‘ãƒœãƒ¼ãƒ€ãƒ¼ + "ğŸ¯ çš„ä¸­!" ãƒãƒƒã‚¸ + ãƒã‚¤ãƒ³ãƒˆè¡¨ç¤º
- ãƒã‚ºãƒ¬: ã‚°ãƒ¬ãƒ¼èƒŒæ™¯ + å·¦ãƒœãƒ¼ãƒ€ãƒ¼èµ¤ï¼ˆæ§ãˆã‚ã€ç«¶é¦¬ã®çš„ä¸­ç‡ã‚’è€ƒæ…®ï¼‰
- æœªæŠ•ç¥¨: ãƒ©ã‚¤ãƒˆã‚°ãƒ¬ãƒ¼
- æŠ•ç¥¨æ¸ˆ: "âœ… æŠ•ç¥¨æ¸ˆ" ãƒãƒƒã‚¸

### 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ•ã‚£ãƒ¼ãƒ‰
- **API**: `src/app/api/users/[userId]/activity/route.ts`ï¼ˆæ–°è¦ï¼‰
- **Component**: `src/components/social/UserActivityFeed.tsx`ï¼ˆæ–°è¦ï¼‰
- **çµ±åˆå…ˆ**: `src/app/(main)/users/[userId]/page.tsx`
- æŠ•ç¥¨ï¼ˆpending/hit/missï¼‰ã¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’ `created_at` åŸºæº–ã§æ™‚ç³»åˆ—ãƒãƒ¼ã‚¸
- cursor-based paginationï¼ˆ5ä»¶/ãƒšãƒ¼ã‚¸ï¼‰+ IDé‡è¤‡æ’é™¤
- è¡¨ç¤º: ğŸ—³æŠ•ç¥¨/ğŸ¯çš„ä¸­/ğŸ“Šçµæœ/ğŸ’¬ã‚³ãƒ¡ãƒ³ãƒˆ

### 4. ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ç«¶é¦¬å ´åˆ¥ãƒ¬ãƒ¼ã‚¹ã‚«ãƒ¼ãƒ‰
- **Component**: `src/components/races/NextRaceByVenue.tsx`ï¼ˆæ–°è¦ï¼‰
- **çµ±åˆå…ˆ**: `src/app/(main)/page.tsx`
- netkeibaé¢¨: ç«¶é¦¬å ´ã”ã¨ã«æ¬¡ãƒ¬ãƒ¼ã‚¹1æšè¡¨ç¤º
- ã‚°ãƒ¬ãƒ¼ãƒ‰åˆ¥ã‚«ãƒ©ãƒ¼ï¼ˆG1é»„/G2èµ¤/G3ç·‘ï¼‰
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ï¼ˆ10ç§’æ›´æ–°ã€15åˆ†ä»¥å†…ã¯èµ¤ãƒ‘ãƒ«ã‚¹ï¼‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–: 3å ´â†’grid-cols-3ã€2å ´â†’grid-cols-2

---

## é‡è¦ãªè¨­è¨ˆåˆ¤æ–­

### æŠ•ç¥¨ç· åˆ‡ãƒ­ã‚¸ãƒƒã‚¯
```typescript
const deadline = new Date(race.post_time).getTime() - 2 * 60 * 1000;
// ç™ºèµ°2åˆ†å‰ãŒæŠ•ç¥¨ç· åˆ‡
```

### ãƒã‚¤ãƒ³ãƒˆåˆ¶åº¦ï¼ˆPhase Kæ”¹ä¿®æ¸ˆã¿ï¼‰
- ã‚°ãƒ¬ãƒ¼ãƒ‰åˆ¥ãƒœãƒ¼ãƒŠã‚¹: G1Ã—2.0, G2Ã—1.5, G3Ã—1.3, OPÃ—1.0
- ç©´é¦¬(â–³)ã¯äººæ°—åº¦ã§åŠ ç®—: 6ç•ªäººæ°—ä»¥ä¸‹ +50Pã€œ+200P
- ãƒ©ãƒ³ã‚¯: åˆå¿ƒè€…(0)â†’è¦‹ç¿’ã„(500)â†’ä¸€äººå‰(2000)â†’ãƒ™ãƒ†ãƒ©ãƒ³(5000)â†’é”äºº(12000)â†’é‰„äºº(25000)

### Cronè¨­å®šï¼ˆvercel.jsonï¼‰
```json
{
  "crons": [
    { "path": "/api/cron/auto-settle", "schedule": "*/10 * * * *" },
    { "path": "/api/cron/update-entries", "schedule": "0 */3 * * *" }
  ]
}
```

### RLSãƒã‚¤ãƒ‘ã‚¹
- ç®¡ç†è€…æ“ä½œ: `createAdminClient()`ï¼ˆ`@/lib/admin`ï¼‰ã‚’ä½¿ç”¨

---

## æ—¢çŸ¥ã®èª²é¡Œï¼ˆè¦å¯¾å¿œï¼‰

### ğŸ”´ å³æ™‚å¯¾å¿œãŒå¿…è¦
1. **äº¬éƒ½è¨˜å¿µã®gradeä¿®æ­£**: OP â†’ G2
   ```sql
   UPDATE races SET grade = 'G2' WHERE name = 'äº¬éƒ½è¨˜å¿µ' AND race_date = '2026-02-15';
   ```
2. **å…±åŒé€šä¿¡æ¯ã®gradeä¿®æ­£**: OP â†’ G3
   ```sql
   UPDATE races SET grade = 'G3' WHERE name = 'å…±åŒé€šä¿¡æ¯' AND race_date = '2026-02-15';
   ```

### ğŸŸ¡ èª¿æŸ»ãŒå¿…è¦
3. **ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—ã®ã‚°ãƒ¬ãƒ¼ãƒ‰åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯**: G2/G3ãŒæ­£ã—ãå–å¾—ã§ãã¦ã„ãªã„å¯èƒ½æ€§
   - å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/api/admin/scrape/route.ts`
   - netkeibaä¸Šã®ã‚°ãƒ¬ãƒ¼ãƒ‰è¡¨è¨˜ã¨ãƒ‘ãƒ¼ã‚¹å‡¦ç†ã‚’ç¢ºèª

4. **CronæŠ•ç¥¨ã‚«ã‚¦ãƒ³ãƒˆ**: æŠ•ç¥¨æ•°ã®è‡ªå‹•æ›´æ–°ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹è¦ç¢ºèª

---

## ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

### ãƒšãƒ¼ã‚¸
```
src/app/(main)/page.tsx              - ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ï¼ˆç«¶é¦¬å ´åˆ¥ã‚«ãƒ¼ãƒ‰ï¼‰
src/app/(main)/races/page.tsx        - ãƒ¬ãƒ¼ã‚¹ä¸€è¦§ï¼ˆ3ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
src/app/(main)/races/[raceId]/page.tsx - ãƒ¬ãƒ¼ã‚¹è©³ç´°ãƒ»æŠ•ç¥¨
src/app/(main)/users/[userId]/page.tsx - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ•ã‚£ãƒ¼ãƒ‰ï¼‰
src/app/(main)/mypage/page.tsx       - ãƒã‚¤ãƒšãƒ¼ã‚¸
src/app/(main)/admin/page.tsx        - ç®¡ç†ç”»é¢
```

### API
```
src/app/api/cron/auto-settle/route.ts    - è‡ªå‹•ç²¾ç®—
src/app/api/cron/update-entries/route.ts - ãƒ¬ãƒ¼ã‚¹æƒ…å ±æ›´æ–°
src/app/api/admin/scrape/route.ts        - netkeiba ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—
src/app/api/admin/re-settle/route.ts     - å†ç²¾ç®—API
src/app/api/races/[raceId]/votes/route.ts - æŠ•ç¥¨API
src/app/api/users/[userId]/activity/route.ts - ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ•ã‚£ãƒ¼ãƒ‰
src/app/api/timeline/route.ts            - ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³
```

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆä»Šå›è¿½åŠ ãƒ»å¤‰æ›´ï¼‰
```
src/components/races/RaceCard.tsx         - çµæœè‰²åˆ†ã‘å¯¾å¿œ
src/components/races/NextRaceByVenue.tsx  - æ–°è¦: ç«¶é¦¬å ´åˆ¥ã‚«ãƒ¼ãƒ‰
src/components/social/UserActivityFeed.tsx - æ–°è¦: ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ•ã‚£ãƒ¼ãƒ‰
```

---

## é–‹ç™ºãƒ«ãƒ¼ãƒ«

- ä¿®æ­£ã¯Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆ(.py)ã§ä½œæˆã—ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œ
- TASKLIST.mdï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆï¼‰ã‚’ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†æ™‚ã«æ›´æ–°ã—ã¦commit
- ç™ºèµ°æ™‚åˆ»ã‚«ãƒ©ãƒ ã¯ `post_time`ï¼ˆstart_timeã§ã¯ãªã„ï¼‰
- RLSãƒã‚¤ãƒ‘ã‚¹ã¯ `createAdminClient()`ï¼ˆ@/lib/adminï¼‰
- DBæ¥ç¶š: Supabase SQL Editorã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

---

## ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
npm run build
git add -A && git commit -m "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸" && git push
# VercelãŒè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
```

# Gate-In! タスクリスト

最終更新: 2026-02-15

---

## ✅ 完了タスク

### 2026-02-15: オッズ連動ポイント＆△抑え実装

#### Phase 1: DB・定数変更
- [x] `vote_picks.pick_type`に`back`を追加
- [x] `ranks.ts`にオッズ連動ポイントテーブル追加
  - `getWinPointsByOdds()`
  - `getPlacePointsByOdds()`
  - `getQuinellaPointsByOdds()`
  - `getWidePointsByOdds()`
  - `getTrioPointsByOdds()`
  - `getBackMultiplier()`

#### Phase 2: 投票UI
- [x] `VoteForm.tsx`に△タブ追加（0〜5頭）
- [x] `VoteEditForm.tsx`に△タブ追加
- [x] 危険馬マークを△→⚠️に変更
- [x] 投票API（`/api/races/[raceId]/votes`）にbackPicks対応

#### Phase 3: 精算ロジック
- [x] `settle-race.ts`全面刷新
  - 馬連判定追加
  - ワイド判定追加
  - 三連複判定追加（△倍率対応）
  - オッズ連動ポイント計算

#### Phase 4: 表示系更新
- [x] `VoteSummary.tsx`に抑え表示追加
- [x] `TimelineItem.tsx`のPICK_STYLEにback追加
- [x] `UserActivityFeed.tsx`のPICK_STYLEにback追加
- [x] `VoteDistribution.tsx`に△タブ追加
- [x] レース詳細ページのポイント目安を新システムに更新

#### Phase 5: ガイド・バッジ
- [x] `/guide/points`ポイントガイドページ全面刷新
- [x] `profiles.featured_badge_id`カラム追加
- [x] 馬券バッジ6種類追加（DB）
- [x] `badges.ts`に馬券バッジ判定追加
- [x] `/mypage/badges`にお気に入りバッジ設定機能追加
- [x] `/api/profile/featured-badge`API作成

#### バグ修正
- [x] 危険馬人気99番問題の修正（結果取得時に人気・オッズを更新）

---

## 📋 未着手タスク

### 高優先度
- [ ] プロフィールページでお気に入りバッジを表示する
- [ ] VoteFormの「獲得ポイント目安」もオッズ連動表示に更新

### 中優先度
- [ ] UI刷新（Phase N）
- [ ] プッシュ通知の実装
- [ ] SNSシェア機能強化

### 低優先度
- [ ] 予想AIアシスタント機能
- [ ] 過去データ分析機能
- [ ] 馬柱表示機能

---

## 🐛 既知の問題

| 問題 | 状態 | 備考 |
|------|:----:|------|
| 危険馬人気99番表示 | ✅解決 | 結果取得時に更新 |

---

## 📝 メモ

### ポイントテーブル早見表

**単勝（◎1着）**
| オッズ | P |
|--------|---|
| 〜1.9 | 20 |
| 2.0〜3.9 | 40 |
| 4.0〜6.9 | 60 |
| 7.0〜14.9 | 100 |
| 15.0〜29.9 | 150 |
| 30.0〜 | 250 |

**馬連（◎○1-2着）**
| オッズ | P |
|--------|---|
| 〜9.9 | 30 |
| 10〜29.9 | 50 |
| 30〜59.9 | 80 |
| 60〜99.9 | 120 |
| 100〜299.9 | 180 |
| 300〜 | 280 |

**三連複（◎○△1-2-3着）**
| オッズ | P |
|--------|---|
| 〜9.9 | 20 |
| 10〜49.9 | 50 |
| 50〜99.9 | 80 |
| 100〜299.9 | 120 |
| 300〜999.9 | 180 |
| 1000〜 | 300 |

**△倍率**
| △の数 | 倍率 |
|--------|------|
| 1頭 | ×1.0 |
| 2頭 | ×0.8 |
| 3頭 | ×0.6 |
| 4頭 | ×0.4 |
| 5頭 | ×0.2 |

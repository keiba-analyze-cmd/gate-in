#!/usr/bin/env python3
"""
TASKLIST.md ã‚’Phase Få®Œäº†ã«æ›´æ–°
å…¨9ã‚¿ã‚¹ã‚¯å®Ÿè¡Œå¾Œã«å®Ÿè¡Œã—ã¦ãã ã•ã„
"""

import os, re
from datetime import date

today = date.today().isoformat()

tasklist_path = "TASKLIST.md"
if not os.path.exists(tasklist_path):
    print(f"âš ï¸  {tasklist_path} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
    exit(1)

with open(tasklist_path, "r") as f:
    content = f.read()

# ============================================================
# 1. ã‚µãƒãƒªãƒ¼ã®ä»¶æ•°æ›´æ–°
# ============================================================
content = re.sub(
    r'\| âœ… å®Œäº† \| \d+ \|',
    '| âœ… å®Œäº† | 32 |',
    content
)
content = re.sub(
    r'\| ğŸ”´ æœªç€æ‰‹ \| \d+ \|',
    '| ğŸ”´ æœªç€æ‰‹ | 25 |',
    content
)

# ============================================================
# 2. Phase E ã‚’ã€Œâœ…å®Œäº†ã€ã«å¤‰æ›´ï¼ˆå¼•ãç¶™ããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è¨˜è¿°ã«åˆã‚ã›ã‚‹ï¼‰
# ============================================================
# å®Ÿæ–½é †åºã®éƒ¨åˆ†ã‚’æ›´æ–°
content = content.replace(
    "Phase E      â†’ UXæ”¹å–„ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼ˆ1ãƒ¶æœˆï¼‰â† æ¬¡ã¯ã“ã“\nPhase F      â†’ æ©Ÿèƒ½è¿½åŠ ï¼ˆ1ã€œ2ãƒ¶æœˆï¼‰",
    f"Phase E      â†’ âœ… å®Œäº†ï¼ˆ{today}ï¼‰\nPhase F      â†’ âœ… å®Œäº†ï¼ˆ{today}ï¼‰"
)

# ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
if "Phase F      â†’ âœ… å®Œäº†" not in content:
    content = content.replace(
        "Phase F      â†’ æ©Ÿèƒ½è¿½åŠ ï¼ˆ1ã€œ2ãƒ¶æœˆï¼‰",
        f"Phase F      â†’ âœ… å®Œäº†ï¼ˆ{today}ï¼‰"
    )

# ============================================================
# 3. Phase F ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¿ã‚¹ã‚¯ã‚’ âœ… ã«æ›´æ–°
# ============================================================
phase_f_tasks = {
    "37": "ãƒãƒƒã‚¸è‡ªå‹•ä»˜ä¸ãƒ­ã‚¸ãƒƒã‚¯",
    "38": "ãƒã‚¤ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ èª¬æ˜ãƒšãƒ¼ã‚¸",
    "39": "æŠ•ç¥¨å¤‰æ›´ãƒ»å–ã‚Šæ¶ˆã—æ©Ÿèƒ½",
    "40": "é¦¬ã‚«ãƒ«ãƒ†ãƒšãƒ¼ã‚¸",
    "41": "ãƒ¬ãƒ¼ã‚¹æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼",
    "42": "ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—é€šçŸ¥",
    "43": "æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ï¼ˆJSON-LDï¼‰",
    "44": "æœˆæ¬¡å¤§ä¼šã®è‡ªå‹•ä½œæˆ",
    "45": "æœˆæ¬¡ãƒã‚¤ãƒ³ãƒˆãƒªã‚»ãƒƒãƒˆ",
}

# Phase F ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ›¸ãæ›ãˆ
new_phase_f = f"""## âœ… Phase F: æ©Ÿèƒ½è¿½åŠ ï¼ˆå®Œäº†ï¼‰

| # | ã‚¿ã‚¹ã‚¯ | èª¬æ˜ | çŠ¶æ…‹ | å®Œäº†æ—¥ |
|---|--------|------|------|--------|
| 37 | ãƒãƒƒã‚¸è‡ªå‹•ä»˜ä¸ãƒ­ã‚¸ãƒƒã‚¯ | æ¡ä»¶é”æˆæ™‚ã«è‡ªå‹•ä»˜ä¸ | âœ…æ¸ˆ | {today} |
| 38 | ãƒã‚¤ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ èª¬æ˜ãƒšãƒ¼ã‚¸ | ãƒ«ãƒ¼ãƒ«è§£èª¬ãƒšãƒ¼ã‚¸ | âœ…æ¸ˆ | {today} |
| 39 | æŠ•ç¥¨å¤‰æ›´ãƒ»å–ã‚Šæ¶ˆã—æ©Ÿèƒ½ | ç· åˆ‡å‰ï¼ˆç™ºèµ°2åˆ†å‰ï¼‰ã«å¤‰æ›´å¯èƒ½ | âœ…æ¸ˆ | {today} |
| 40 | é¦¬ã‚«ãƒ«ãƒ†ãƒšãƒ¼ã‚¸ | éå»æˆç¸¾ãƒ»æˆ¦ç¸¾ä¸€è¦§ | âœ…æ¸ˆ | {today} |
| 41 | ãƒ¬ãƒ¼ã‚¹æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ | ã‚³ãƒ¼ã‚¹ãƒ»ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ»æ—¥ä»˜ãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ | âœ…æ¸ˆ | {today} |
| 42 | ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—é€šçŸ¥ | ãƒ©ãƒ³ã‚¯ä¸Šæ˜‡æ™‚ã«é€šçŸ¥ | âœ…æ¸ˆ | {today} |
| 43 | æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ï¼ˆJSON-LDï¼‰ | ãƒ¬ãƒ¼ã‚¹ã®SportsEventæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ | âœ…æ¸ˆ | {today} |
| 44 | æœˆæ¬¡å¤§ä¼šã®è‡ªå‹•ä½œæˆ | æ¯æœˆ1æ—¥ã«contestä½œæˆï¼ˆVercel Cronï¼‰ | âœ…æ¸ˆ | {today} |
| 45 | æœˆæ¬¡ãƒã‚¤ãƒ³ãƒˆãƒªã‚»ãƒƒãƒˆ | æ¯æœˆ1æ—¥ã«ãƒªã‚»ãƒƒãƒˆï¼ˆVercel Cronï¼‰ | âœ…æ¸ˆ | {today} |
"""

# Phase F ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¤œç´¢ã—ã¦ç½®æ›
pattern = r'## âœ¨ Phase F: æ©Ÿèƒ½è¿½åŠ .*?(?=\n---|\n## ğŸš€)'
match = re.search(pattern, content, re.DOTALL)
if match:
    content = content[:match.start()] + new_phase_f + content[match.end():]
else:
    print("âš ï¸  Phase F ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚æ‰‹å‹•ã§æ›´æ–°ã—ã¦ãã ã•ã„ã€‚")

# ============================================================
# 4. æ›´æ–°å±¥æ­´ã«è¿½åŠ 
# ============================================================
history_entry = f"| {today} | Phase F å®Œäº†ï¼ˆãƒãƒƒã‚¸è‡ªå‹•ä»˜ä¸ã€ãƒã‚¤ãƒ³ãƒˆèª¬æ˜ã€æŠ•ç¥¨å¤‰æ›´/å–æ¶ˆã€é¦¬ã‚«ãƒ«ãƒ†ã€æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—é€šçŸ¥ã€JSON-LDã€æœˆæ¬¡å¤§ä¼šCronã€æœˆæ¬¡ãƒªã‚»ãƒƒãƒˆCronï¼‰ |"
content = content.replace(
    "## ğŸ“ æ›´æ–°å±¥æ­´\n\n| æ—¥ä»˜ | å†…å®¹ |\n|------|------|\n",
    f"## ğŸ“ æ›´æ–°å±¥æ­´\n\n| æ—¥ä»˜ | å†…å®¹ |\n|------|------|\n{history_entry}\n"
)

# æœ€çµ‚æ›´æ–°æ—¥ã‚’æ›´æ–°
content = re.sub(
    r'> \*\*æœ€çµ‚æ›´æ–°: \d{4}-\d{2}-\d{2}\*\*',
    f'> **æœ€çµ‚æ›´æ–°: {today}**',
    content
)

with open(tasklist_path, "w") as f:
    f.write(content)

print(f"âœ… {tasklist_path} ã‚’ Phase F å®Œäº†ã«æ›´æ–°")
print(f"\næ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:")
print(f"   git add -A && git commit -m 'Phase F: æ©Ÿèƒ½è¿½åŠ  å…¨9ä»¶å®Œäº†' && git push")

# 🏇 ゲートイン！ タスク一覧

> **最終更新: 2026-02-14**
> このファイルはプロジェクトルートに配置。`git push` で常に最新状態を共有。

---

## 📊 サマリー

| 状態 | 件数 |
|------|------|
| ✅ 完了 | 49 |
| 🔴 未着手 | 27 |
| **合計** | **76** |

### 実施順序（推奨）

```
Phase A       → ✅ 完了（2026-02-14）
Phase B       → ✅ 完了（2026-02-14）
Phase B-fix   → ✅ 完了（2026-02-14）
Phase C-social→ ✅ 完了（2026-02-14）
Phase D       → ✅ 完了（2026-02-14）
Phase F       → ✅ 完了（2026-02-14）
Phase E       → ✅ 完了（2026-02-14）
Phase H       → ✅ 完了（2026-02-14）
Phase J       → ✅ 完了（2026-02-14）
Phase I       → コミュニティ安全性・運用 ← 次はここ
Phase G       → 将来機能（3ヶ月〜）
```

---

## ✅ 完了済み（Phase 0〜B）

| # | フェーズ | カテゴリ | タスク | 完了日 |
|---|---------|---------|--------|--------|
| 1 | Phase A | セキュリティ | 管理画面のアクセス制御 | 2026-02 |
| 2 | Phase A | セキュリティ | RLSポリシー総点検（18テーブル） | 2026-02 |
| 3 | Phase A | セキュリティ | 環境変数の管理 | 2026-02 |
| 4 | Phase A | 法務 | 利用規約の作成・掲載 | 2026-02 |
| 5 | Phase A | 法務 | プライバシーポリシー | 2026-02 |
| 6 | Phase A | 法務 | 特定商取引法に基づく表記 | 2026-02 |
| 7 | Phase A | インフラ | 本番ドメイン gate-in.jp 設定 | 2026-02 |
| 8 | Phase B | データ運用 | レースデータ投入フロー（netkeibaスクレイピング） | 2026-02-14 |
| 9 | Phase B | データ運用 | 管理画面レース登録GUI（4タブ） | 2026-02-14 |
| 10 | Phase B | データ運用 | スクレイピングGUI（プレビュー+一括登録+上書き更新） | 2026-02-14 |
| 11 | Phase B | バグ修正 | 発走時刻タイムゾーン（UTC→JST） | 2026-02-14 |
| 12 | Phase B | バグ修正 | VoteSummary クラッシュ（undefined対策） | 2026-02-14 |
| 13 | Phase B | バグ修正 | VoteDistribution APIキー不一致 | 2026-02-14 |
| 14 | B-fix | バグ修正 | 投票集計RLS修正（全ユーザー集計） | 2026-02-14 |
| 15 | B-fix | バグ修正 | ポイント目安に2〜3番人気追加 | 2026-02-14 |
| 16 | C-social | 新機能 | TLリプライ + フォロー一覧ページ | 2026-02-14 |
| 17 | C-social | UI改善 | TOP重賞複数化、投票済タグ、リンク整備 | 2026-02-14 |
| 18 | D | マーケ | OGP画像動的生成（レースごと） | 2026-02-14 |
| 19 | D | マーケ | Twitterカード最適化 | 2026-02-14 |
| 20 | D | マーケ | SNSシェアボタン（予想内容付き） | 2026-02-14 |
| 21 | D | SEO | sitemap.xml / robots.txt | 2026-02-14 |
| 22 | D | マーケ | ランディングページ（未ログイン向け） | 2026-02-14 |
| 23 | D | マーケ | Google Analytics GA4導入 | 2026-02-14 |

---

## ✅ Phase B-fix: バグ修正（完了）

| # | タスク | 説明 | 状態 | 対象ファイル |
|---|--------|------|------|-------------|
| 14 | 投票集計が自分の分しか表示されない | createAdminClientで全ユーザー集計に修正 | ✅済 | votes/route.ts, page.tsx VoteStats |
| 15 | 獲得ポイント目安に2〜3番人気がない | 2〜3番人気(+100P)行を追加 | ✅済 | races/[raceId]/page.tsx |

---

## ✅ Phase C-social: ユーザーフィードバック対応（完了）

| # | タスク | 説明 | 状態 | 対象ファイル |
|---|--------|------|------|-------------|
| 16 | TLコメントにリプライ機能 | タイムラインから直接リプライ。parent_id活用 | ✅済 | TimelineItem.tsx, /api/timeline |
| 17 | フォロー/フォロワー一覧ページ | タップ→一覧→ユーザーページ遷移 | ✅済 | mypage/follows, users/[userId]/follows |

**追加で実施したUI改善:**
- TOPコメントのユーザーをタップでプロフィール遷移
- マイページのポイント表示をタップでポイント履歴へ
- 他ユーザーのフォロー/フォロワー数もタップで一覧へ
- TOPの注目レース→今週の重賞を全件表示（G1金/G2赤/G3緑カード）
- レース一覧に「✅ 投票済」タグ表示
- ヘッダーのマイページアイコンをモバイル常時表示化

---

## ✅ Phase D: OGP・SNS・マーケティング（完了）

| # | タスク | 説明 | 状態 | 対象ファイル |
|---|--------|------|------|-------------|
| 18 | OGP画像の動的生成 | レースごとにG1金/G2赤/G3緑のOG画像 | ✅済 | /api/og/route.tsx |
| 19 | Twitterカード最適化 | summary_large_image + レースmetadata | ✅済 | races/[raceId]/layout.tsx |
| 20 | SNSシェアボタン | X/LINEシェア。予想内容+曜日+URL付き | ✅済 | ShareButtons.tsx, races/[raceId]/page.tsx |
| 21 | sitemap.xml / robots.txt | 全レースURL自動生成 + クロール制御 | ✅済 | sitemap.ts, robots.ts |
| 22 | ランディングページ | 未ログインTOPに特徴・ポイント・景品・CTA | ✅済 | LandingHero.tsx, page.tsx |
| 23 | Google Analytics導入 | GA4コンポーネント（Cookie同意連動） | ✅済 | GoogleAnalytics.tsx, layout.tsx |

---

## ✅ Phase E: UX改善・パフォーマンス（完了）

| # | タスク | 説明 | 状態 | 完了日 |
|---|--------|------|------|--------|
| 24 | 投票確認画面 | 投票前の確認モーダル | ✅済 | 2026-02-14 |
| 25 | レース結果画面の改善 | 着順・配当金・的中者ハイライト | ✅済 | 2026-02-14 |
| 26 | エラーページ（404/500） | カスタム not-found.tsx / error.tsx + エラー送信 | ✅済 | 2026-02-14 |
| 27 | トースト通知 | 投票完了等のフィードバック | ✅済 | 2026-02-14 |
| 28 | 投票締切カウントダウン | 発走時刻までのタイマー | ✅済 | 2026-02-14 |
| 29 | ローディング・スケルトン表示 | 主要6ページにloading.tsx追加 | ✅済 | 2026-02-14 |
| 30 | 初回ログインチュートリアル | WelcomeModalオンボーディング | ✅済 | 2026-02-14 |
| 31 | ページキャッシュ戦略 | races(60s), rankings(120s), contest(120s), horses(300s), 法務(86400s) | ✅済 | 2026-02-14 |
| 32 | DBインデックス最適化 | votes, comments, follows, notifications等 27インデックス | ✅済 | 2026-02-14 |
| 33 | 画像最適化 | アバターをnext/image + unoptimized に変換 | ✅済 | 2026-02-14 |
| 34 | エラー監視の導入 | error-logger.ts + /api/error-report（Vercel Logs連携） | ✅済 | 2026-02-14 |
| 35 | APIレート制限 | rate-limit.ts。votes/comments/follows/profile/timeline全API適用 | ✅済 | 2026-02-14 |
| 36 | 入力値バリデーション強化 | validation.ts拡充（UUID, cursor, 文字列長）+ 全API適用 | ✅済 | 2026-02-14 |

---

## ✅ Phase F: 機能追加（完了）

| # | タスク | 説明 | 状態 | 完了日 |
|---|--------|------|------|--------|
| 37 | バッジ自動付与ロジック | 条件達成時に自動付与（19種） | ✅済 | 2026-02-14 |
| 38 | ポイントシステム説明ページ | ルール・ランク・FAQ解説ページ | ✅済 | 2026-02-14 |
| 39 | 投票変更・取り消し機能 | 締切前（発走2分前）に変更可能 | ✅済 | 2026-02-14 |
| 40 | 馬カルテページ | 過去成績・戦績一覧 | ✅済 | 2026-02-14 |
| 41 | レース検索・フィルター | コース・グレード・日付・キーワード | ✅済 | 2026-02-14 |
| 42 | ランクアップ通知 | ランク上昇時に通知 | ✅済 | 2026-02-14 |
| 43 | 構造化データ（JSON-LD） | レースのSportsEvent構造化データ | ✅済 | 2026-02-14 |
| 44 | 月次大会の自動作成 | 毎月1日にcontest作成（Vercel Cron） | ✅済 | 2026-02-14 |
| 45 | 月次ポイントリセット | 毎月1日にリセット（Vercel Cron） | ✅済 | 2026-02-14 |

---

## ✅ Phase H: コンプライアンス・アカウント管理（完了）

| # | タスク | 説明 | 状態 | 完了日 |
|---|--------|------|------|--------|
| 58 | 退会/アカウント削除機能 | 確認テキスト入力→データ匿名化→Auth削除 | ✅済 | 2026-02-14 |
| 59 | お問い合わせページ | フォーム送信→DB保存（Phase Jで拡張） | ✅済 | 2026-02-14 |
| 60 | Cookie同意バナー | 初回訪問時バナー→同意後にGA4読込 | ✅済 | 2026-02-14 |
| 61 | 通知設定ページ | 8種別のON/OFFトグル | ✅済 | 2026-02-14 |
| 62 | 通知の既読管理 | Header未読バッジ + 一括既読 + API PATCH | ✅済 | 2026-02-14 |
| 63 | 予想履歴ページ | 全投票一覧（的中/ハズレ色分け、ページネーション） | ✅済 | 2026-02-14 |

---

## ✅ Phase J: ログイン・問い合わせ・プロフィール強化（完了）

| # | タスク | 説明 | 状態 | 完了日 |
|---|--------|------|------|--------|
| 73 | 管理画面お問い合わせ対応 | AdminTabs「📩お問い合わせ」タブ。ステータス管理・メモ・フィルター | ✅済 | 2026-02-14 |
| 74 | 会員登録プロフィール拡充 | 初回セットアップ画面（性別・年代・競馬歴・好きな競馬場） | ✅済 | 2026-02-14 |
| 75 | Google/X OAuth設定 | コード実装済み。設定手順ドキュメント（docs/OAUTH_SETUP.md） | ✅済 | 2026-02-14 |
| 76 | ログインページ最適化 | LP風デザイン・特徴訴求・パスワードリセット・日本語エラー | ✅済 | 2026-02-14 |

---

## 🛡 Phase I: コミュニティ安全性・運用品質

> ユーザー増加に備えたモデレーション・運用ツール

| # | タスク | 説明 | 優先度 | 工数 |
|---|--------|------|--------|------|
| 64 | コメント通報機能 | 通報ボタン→理由選択→管理者に通知 | 🟠高 | 0.5日 |
| 65 | コメント編集・削除 | 自分のコメントを編集/削除可能に | 🟠高 | 0.5日 |
| 66 | ユーザーブロック機能 | ブロック→TL・コメント非表示 | 🟡中 | 1日 |
| 67 | 管理者コメント管理画面 | コメント一覧・削除・非表示・通報対応 | 🟡中 | 1日 |
| 68 | ユーザー検索 | 名前でユーザーを検索してプロフィール表示 | 🟡中 | 0.5日 |
| 69 | レースカレンダー | 週間/月間のレーススケジュール俯瞰（カレンダーUI） | 🟢低 | 1日 |
| 70 | ヘルスチェックAPI | /api/health エンドポイント。外部監視ツール連携用 | 🟡中 | 0.5日 |
| 71 | DBバックアップ戦略 | Supabase自動バックアップ設定 + 復元手順ドキュメント | 🟡中 | 0.5日 |
| 72 | ステージング環境 | Vercel Preview Deployment + 環境分離手順 | 🟡中 | 0.5日 |

---

## 🚀 Phase G: 将来の機能

| # | タスク | 説明 | 優先度 | 工数 |
|---|--------|------|--------|------|
| 46 | JRA-VAN API連携 | レースデータ自動取得 | 🟡中 | 5日 |
| 47 | AI予想機能 | 過去データに基づくAI予想 | 🟢低 | 5日 |
| 48 | PWA対応 | ホーム画面追加・オフライン | 🟡中 | 1日 |
| 49 | リアルタイムチャット | レース中ライブチャット | 🟢低 | 3日 |
| 50 | プッシュ通知 | ブラウザ通知 | 🟢低 | 2日 |
| 51 | 予想の公開・非公開設定 | 投票の公開制御 | 🟢低 | 1日 |
| 52 | 広告枠の設計 | AdSense or アフィリエイト | 🟢低 | 2日 |
| 53 | プレミアム会員プラン | Stripe連携 月額課金 | 🟢低 | 5日 |
| 54 | 管理ダッシュボード強化 | KPIダッシュボード | 🟡中 | 2日 |
| 55 | E2Eテスト自動化 | Playwright | 🟡中 | 3日 |
| 56 | CI/CDパイプライン | GitHub Actions | 🟡中 | 1日 |
| 57 | ネイティブアプリ化 | React Native等 | 🟢低 | 20日 |

---

## 📝 更新履歴

| 日付 | 内容 |
|------|------|
| 2026-02-14 | Phase J 完了（管理画面お問い合わせ対応、会員登録プロフィール拡充、Google/X OAuth設定、ログインページ最適化）。合計76タスク・49件完了 |
| 2026-02-14 | Phase E残り完了（スケルトン、キャッシュ拡充、画像最適化、エラー監視、バリデーション強化）+ Phase H完了（退会機能、お問い合わせ、Cookie同意、通知設定、予想履歴） |
| 2026-02-14 | ギャップ分析実施。Phase H（コンプライアンス・アカウント管理）6件、Phase I（コミュニティ安全性・運用）9件を追加 |
| 2026-02-14 | Phase F 完了（バッジ自動付与、ポイント説明、投票変更/取消、馬カルテ、検索フィルター、ランクアップ通知、JSON-LD、月次大会Cron、月次リセットCron） |
| 2026-02-14 | Phase D 完了（OGP画像、Twitterカード、SNSシェア、sitemap、LP、GA4） |
| 2026-02-14 | Phase C-social 完了（TLリプライ、フォロー一覧、TOP重賞複数化、投票済タグ、UI改善多数） |
| 2026-02-14 | Phase B-fix 完了（バグ2件: 投票集計RLS修正、ポイント目安2〜3番人気追加） |
| 2026-02-14 | Phase B 完了。ユーザーFBからバグ2件+新機能2件追加。ロードマップ再構成 |
| 2026-02-13 | Phase A 完了。Phase B 着手 |
| 2026-02-12 | 初版作成（53タスク） |

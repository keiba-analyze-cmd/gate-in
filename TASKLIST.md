# ゲートイン！ タスクリスト

## 📅 最終更新: 2026-02-21

---

## ✅ 完了タスク

### インフラ・基盤
- [x] Next.js + Supabase + Vercel 基盤構築
- [x] Google OAuth ログイン
- [x] X（Twitter）OAuth ログイン
- [x] ダークモード対応（ThemeContext）
- [x] レート制限（rate-limit）
- [x] LP ダークモード削除（ライトモード強制）
- [x] Resendメール基盤（週末案内・休眠復帰）
- [x] Firebase プッシュ通知設定（新プロジェクト: gate-in-notifications）

### ユーザー機能
- [x] プロフィール初期設定（setup）
- [x] プロフィール編集（display_name, bio）
- [x] ログアウト機能
- [x] アバター絵文字選択（20種類）
- [x] ユーザーID（@handle）機能
- [x] NGワードフィルター
- [x] フォロー/フォロワー機能
- [x] ブロック機能
- [x] 通知機能
- [x] バッジシステム
- [x] ランク機能（予想士I〜X）
- [x] アカウント削除

### レース・予想
- [x] レース一覧・詳細
- [x] 予想投票（◎○▲△）
- [x] 的中判定・ポイント計算
- [x] コメント機能（リアクション付き）
- [x] タイムライン
- [x] 人気予想セクション
- [x] 投票締切延長（発走30秒後まで）
- [x] 重賞グレード自動判定修正
- [x] レース一覧の的中ランク表示修正（vote_picksで正確判定）
- [x] VoteSummaryから不要な「対抗」セクション削除
- [x] 投票シェアカード自動消失修正（手動で閉じるまで表示）
- [x] タイムライン更新ボタン追加
- [x] 掲示板投稿エラー修正

### ランキング・大会
- [x] ランキング（累計・月間・連勝）
- [x] いいねランキング
- [x] 週間MVP
- [x] 大会（コンテスト）機能
- [x] ランキング→プロフィールリンク修正
- [x] 週間予想大会の参加条件を3レース以上に変更
- [x] 管理画面に大会作成機能追加（🏆タブ）
- [x] 大会入賞者へのメール通知

### X自動投稿システム
- [x] DBテーブル作成（x_scheduled_posts）
- [x] Cron API（/api/cron/x-post、10分ごと実行）
- [x] 管理画面（/admin/x-posts）
- [x] 動的変数置換（{{weekly_mvp}}, {{today_date}}）
- [x] 投稿スケジュール設計（平日2投稿、土日各1投稿）
- [x] 1週間分の投稿予約（11件）

### Slack連携
- [x] チャンネル設計（kpi, sns, support, alerts）
- [x] KPIデイリーレポート（毎日0:00 JST自動送信）
- [x] X投稿完了/エラー通知
- [x] お問い合わせ通知
- [x] コメント通報通知
- [x] slack.tsユーティリティ関数

### TOPページ改善
- [x] G1カードの投票人数表示修正
- [x] 重賞カードに残り時間・投票人数追加
- [x] 見出しの色修正

### 管理画面
- [x] ダッシュボード（KPI表示）
- [x] レース管理
- [x] ユーザー管理
- [x] コメント通報管理
- [x] お問い合わせ管理
- [x] HERO画像設定
- [x] X投稿管理
- [x] 大会作成・レース選択機能

### バグ修正（2026-02-21）
- [x] auto-settle: 払戻未確定時はスキップしてリトライ
- [x] settle-race: points_transactionsエラーチェック追加
- [x] オッズ更新を5分ごとに変更（土日）
- [x] 掲示板コメントAPI修正（is_hidden削除、レスポンス形式修正）

---

## 🔄 進行中

### 調査中
- [ ] Xログインエラー調査（requested path is invalid）
  - 組織URL設定済み、要テスト

---

## 📋 未着手・今後のタスク

### 優先度: 高
- [ ] 競馬道場リニューアル（ステージ制）
- [ ] SEO対策（メタタグ、OGP、サイトマップ）
- [ ] 記事生成（Wave 7-13）

### 優先度: 中
- [ ] プッシュ通知テスト・動作確認
- [ ] 予想コピー機能の改善
- [ ] Slack追加機能（新規ユーザー通知、レース結果通知等）
- [ ] パフォーマンス最適化

### 優先度: 低
- [ ] PWA対応
- [ ] ネイティブアプリ検討
- [ ] 多言語対応

---

## 📱 X投稿スケジュール

| 曜日 | 時間 | 内容 |
|------|------|------|
| 月 | 12:00 | 週間MVP発表 |
| 月 | 20:00 | ユーザー参加型（質問） |
| 火 | 12:00 | 競馬豆知識 |
| 火 | 20:00 | クイズ出題 |
| 水 | 12:00 | 機能紹介 |
| 水 | 20:00 | クイズ答え |
| 木 | 12:00 | 競馬コラム |
| 木 | 20:00 | 週末予想促進 |
| 金 | 18:00 | 週末レース告知 |
| 土 | 7:30 | 当日レース案内 |
| 日 | 7:30 | メインレース案内 |

---

## 🏆 週間予想大会運用

### 参加条件
- **3レース以上**予想で自動エントリー（参加ボタン不要）

### 賞金
- 1位: ¥5,000（Amazonギフト券）
- 2位: ¥3,000
- 3位: ¥2,000

### 運用フロー
1. **土曜日**: 日曜のレース情報をスクレイピング
2. **土曜日**: 管理画面（/admin?tab=contest）でWIN5対象5レースを選択
3. **日曜日**: ユーザーが予想、3レース以上で自動エントリー
4. **金曜日16:05**: Cronで前週大会クローズ、入賞者に通知＋メール送信

---

## 📊 Slack通知一覧

| チャンネル | 通知内容 | タイミング |
|-----------|---------|-----------|
| #gate-in-kpi | デイリーレポート | 毎日0:00 JST |
| #gate-in-sns | X投稿完了 | 投稿成功時 |
| #gate-in-sns | X投稿エラー | 投稿失敗時 |
| #gate-in-support | お問い合わせ | 受信時 |
| #gate-in-support | コメント通報 | 通報時 |
| #gate-in-alerts | エラー通知 | API失敗時 |

---

## 🛠️ 技術スタック

- **フロントエンド**: Next.js 16.1.6 (App Router, Turbopack)
- **バックエンド**: Supabase (PostgreSQL, Auth, Storage)
- **デプロイ**: Vercel
- **CMS**: microCMS（記事・クイズ）
- **メール**: Resend
- **SNS連携**: X API v2（twitter-api-v2）
- **通知**: Slack Incoming Webhooks, Firebase Cloud Messaging
- **スタイリング**: Tailwind CSS

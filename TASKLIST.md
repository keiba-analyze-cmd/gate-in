# ゲートイン！ タスク進捗管理

## 2026-02-20 完了タスク

### 🐛 バグ修正

| タスク | 状態 | 備考 |
|--------|------|------|
| Firebase未設定時のエラー回避 | ✅完了 | 通知ONでクラッシュする問題を修正 |
| 今週の重賞にOP表示される問題 | ✅完了 | G2/G3のみ表示、G2→G3順でソート |
| 斤量が枠番で表示される問題 | ✅完了 | スクレイピングの列インデックス修正 |
| 日付タブがタップできない問題 | ✅完了 | タイムゾーン処理をJST固定に修正 |
| 重賞グレードがOPになる問題 | ✅完了 | 主要重賞のマッピングテーブル追加 |

### ✨ 機能改善

| タスク | 状態 | 備考 |
|--------|------|------|
| 投票締め切り時間の延長 | ✅完了 | 発走2分前 → 発走30秒後に変更 |
| 結果取得タイミング変更 | ✅完了 | 発走10分後 → 15分後に変更 |
| レース一覧のデフォルト表示改善 | ✅完了 | 今週に投票可能レースがあれば今週を表示 |
| 管理画面から既存レース更新可能に | ✅確認 | 既存機能で対応可（登録済みにチェック） |

### 📝 DB修正（SQL実行）

| タスク | 状態 | 備考 |
|--------|------|------|
| フェブラリーS グレード修正 | ✅完了 | OP → G1 |
| 小倉大賞典 グレード修正 | ✅完了 | OP → G3 |
| ダイヤモンドS グレード修正 | ✅完了 | OP → G3 |
| 阪急杯 グレード修正 | ✅完了 | OP → G2 |

---

## 保留・今後のタスク

### 📋 管理機能

| タスク | 状態 | 備考 |
|--------|------|------|
| 手動でレース結果を更新できる機能 | 🔲未着手 | cronで取得失敗時の対応用 |

### 🔔 通知機能

| タスク | 状態 | 備考 |
|--------|------|------|
| Firebase環境変数の設定 | 🔲未着手 | Vercelに設定が必要 |
| プッシュ通知の有効化 | 🔲未着手 | Firebase設定後 |

### 📱 UI/UX改善

| タスク | 状態 | 備考 |
|--------|------|------|
| noteの記事用ワイヤーフレーム | ✅完了 | 8画面分のHTMLを作成済み |

---

## 技術的な変更履歴

### 投票締め切りロジック
```
変更前: post_time - 2分
変更後: post_time + 30秒
```
対象ファイル:
- `src/app/api/races/[raceId]/votes/route.ts`
- `src/app/(main)/page.tsx`
- `src/app/(main)/races/page.tsx`
- `src/components/races/NextRaceByVenue.tsx`
- `src/components/races/VoteEditForm.tsx`
- `src/components/races/RaceCardCountdown.tsx`

### 結果取得cronタイミング
```
変更前: 発走10分後〜40分後
変更後: 発走15分後〜45分後
```
対象ファイル: `src/app/api/cron/auto-settle/route.ts`

### 重賞グレード自動判定
主要重賞（G1: 24レース、G2: 30レース、G3: 50レース以上）のマッピングを追加
対象ファイル: `src/app/api/admin/scrape/route.ts`

---

## 📢 X（Twitter）運用関連

### 自動投稿システム（Option C: Vercel Cron）

| タスク | 状態 | 備考 |
|--------|------|------|
| X Developer Account | ✅完了 | 既にお持ち |
| 投稿スケジュールDBテーブル作成 | 🔲未着手 | x_scheduled_posts |
| Cron API実装（/api/cron/x-post） | 🔲未着手 | |
| 管理画面に投稿管理追加 | 🔲未着手 | |
| 1ヶ月分の投稿カレンダー | ✅完了 | x_posting_calendar.xlsx |

### Slack連携オペレーション（検討中）

| タスク | 状態 | 備考 |
|--------|------|------|
| 要件整理 | 🔲未着手 | 後ほど議論 |

---
